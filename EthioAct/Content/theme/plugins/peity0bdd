(function(n,t,i){var u=function(i,r){var u=t.createElementNS("http://www.w3.org/2000/svg",i);return n.each(r,function(n,t){u.setAttribute(n,t)}),u},s="createElementNS"in t&&u("svg",{}).createSVGRect,e=1/(window.devicePixelRatio||1),r=n.fn.peity=function(t,i){return s&&this.each(function(){var f=n(this),u=f.data("peity"),e,s,h;u?(t&&(u.type=t),n.extend(u.opts,i)):(e=r.defaults[t],s={},n.each(f.data(),function(n,t){n in e&&(s[n]=t)}),h=n.extend({},e,s,i),u=new o(f,t,h),f.change(function(){u.draw()}).data("peity",u));u.draw()}),this},o=function(n,t,i){this.$el=n;this.type=t;this.opts=i},f=o.prototype;f.draw=function(){r.graphers[this.type].call(this,this.opts)};f.fill=function(){var t=this.opts.fill,i=t;return n.isFunction(i)||(i=function(n,i){return t[i%t.length]}),i};f.prepare=function(t,i){var r;return this.svg?r=n(this.svg).empty():(this.svg=u("svg",{"class":"peity"}),this.$el.hide().after(this.svg),r=n(this.svg).data("peity",this)),this.svg.setAttribute("height",i),this.svg.setAttribute("width",t),r};f.values=function(){return n.map(this.$el.text().split(this.opts.delimiter),function(n){return parseFloat(n)})};r.defaults={};r.graphers={};r.register=function(n,t,i){this.defaults[n]=t;this.graphers[n]=i};r.register("pie",{delimiter:null,diameter:16,fill:["#ff9900","#fff4dd","#ffc66e"]},function(n){var h,t,a,e,o;n.delimiter||(t=this.$el.text().match(/[^0-9\.]/),n.delimiter=t?t[0]:",");t=this.values();"/"==n.delimiter&&(h=t[0],t=[h,i.max(0,t[1]-h)]);for(var r=0,h=t.length,v=0;r<h;r++)v+=t[r];for(var n=this.prepare(n.width||n.diameter,n.height||n.diameter),r=n.width(),s=n.height(),n=r/2,s=s/2,f=i.min(n,s),l=i.PI,y=this.fill(),c=-l/2,r=0;r<h;r++)if(a=t[r],e=a/v,0!=e){if(1==e)o=u("circle",{cx:n,cy:s,r:f});else{o=2*e*l;var e=c+o,p=f*i.cos(c)+n,c=f*i.sin(c)+s,w=f*i.cos(e)+n,b=f*i.sin(e)+s;o=u("path",{d:["M",n,s,"L",p,c,"A",f,f,0,o>l?1:0,1,w,b,"Z"].join(" ")});c=e}o.setAttribute("fill",y.call(this,a,r,t));this.svg.appendChild(o)}});r.register("line",{delimiter:",",fill:"#c6d9fd",height:16,max:null,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(n){var t=this.values();1==t.length&&t.push(t[0]);for(var r=i.max.apply(i,t.concat([n.max])),o=i.min.apply(i,t.concat([n.min])),f=this.prepare(n.width,n.height),s=f.width(),f=f.height()-n.strokeWidth,l=s/(t.length-1),r=r-o,h=0==r?f:f/r,c=f+o*h,r=[0,c],e=0;e<t.length;e++)r.push(e*l,f-h*(t[e]-o)+n.strokeWidth/2);r.push(s,c);t=u("polygon",{fill:n.fill,points:r.join(" ")});this.svg.appendChild(t);n.strokeWidth&&(n=u("polyline",{fill:"transparent",points:r.slice(2,r.length-2).join(" "),stroke:n.stroke,"stroke-width":n.strokeWidth,"stroke-linecap":"square"}),this.svg.appendChild(n))});r.register("bar",{delimiter:",",fill:["#4D89F9"],gap:1,height:16,max:null,min:0,width:32},function(n){for(var r=this.values(),v=i.max.apply(i,r.concat([n.max])),h=i.min.apply(i,r.concat([n.min])),s=this.prepare(n.width,n.height),c=s.width(),s=s.height(),l=v-h,y=0==l?0:s/l,n=n.gap,c=(c+n)/r.length,p=this.fill(),f=0;f<r.length;f++){var o=r[f],a=s-y*(o-h),t=y*o;0==t?(t=e,0>=h&&0<v||0==l)&&(a-=e):0>t&&(a+=t,t=-t);o=u("rect",{fill:p.call(this,o,f,r),x:f*c,y:a,width:c-n,height:t});this.svg.appendChild(o)}})})(jQuery,document,Math)