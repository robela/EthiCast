!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):n("object"==typeof exports?require("jquery"):jQuery)}(function(n){"use strict";var nt=n(window),wt=n(document),p=window.location,i=!0,t=!1,f=null,tt=NaN,w=1/0,it="undefined",v="directive",l=".cropper",bt=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,kt=/^(x|y|width|height)$/,dt=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,y="cropper-modal",h="cropper-hidden",rt="cropper-invisible",gt="cropper-move",ut="cropper-crop",ft="cropper-disabled",et="mousedown touchstart",ot="mousemove touchmove",st="mouseup mouseleave touchend touchleave touchcancel",ht="wheel mousewheel DOMMouseScroll",ct="resize"+l,lt="dblclick",at="build"+l,vt="built"+l,b="dragstart"+l,k="dragmove"+l,d="dragend"+l,a=function(n){return"number"==typeof n},u=function(i,r){this.element=i;this.$element=n(i);this.defaults=n.extend({},u.DEFAULTS,n.isPlainObject(r)?r:{});this.$original=f;this.ready=t;this.built=t;this.cropped=t;this.rotated=t;this.disabled=t;this.replaced=t;this.init()},r=Math.round,g=Math.sqrt,o=Math.min,s=Math.max,e=Math.abs,yt=Math.sin,pt=Math.cos,c=parseFloat;u.prototype={constructor:u,support:{canvas:n.isFunction(n("<canvas>")[0].getContext)},init:function(){var t=this.defaults;n.each(t,function(n,i){switch(n){case"aspectRatio":t[n]=e(c(i))||tt;break;case"autoCropArea":t[n]=e(c(i))||.8;break;case"minWidth":case"minHeight":t[n]=e(c(i))||0;break;case"maxWidth":case"maxHeight":t[n]=e(c(i))||w}});this.image={rotate:0};this.load()},load:function(){var u,t,e=this,f=this.$element,s=this.element,r=this.image,o="";f.is("img")?t=f.prop("src"):f.is("canvas")&&this.support.canvas&&(t=s.toDataURL());t&&(this.replaced&&(r.rotate=0),this.defaults.checkImageOrigin&&(f.prop("crossOrigin")||this.isCrossOriginURL(t))&&(o=" crossOrigin"),this.$clone=u=n("<img"+o+' src="'+t+'">'),u.one("load",function(){r.naturalWidth=this.naturalWidth||u.width();r.naturalHeight=this.naturalHeight||u.height();r.aspectRatio=r.naturalWidth/r.naturalHeight;e.url=t;e.ready=i;e.build()}),u.addClass(rt).prependTo("body"))},isCrossOriginURL:function(n){var r=n.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!r||r[1]===p.protocol&&r[2]===p.hostname&&r[3]===p.port?t:i},build:function(){var e,r,f=this.$element,t=this.defaults;this.ready&&(this.built&&this.unbuild(),f.one(at,t.build),e=n.Event(at),f.trigger(e),e.isDefaultPrevented()||(this.$cropper=r=n(u.TEMPLATE),f.addClass(h),this.$clone.removeClass(rt).prependTo(r),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(h).prependTo(this.$cropper),this.originalImage=n.extend({},this.image)),this.$container=f.parent(),this.$container.append(r),this.$canvas=r.find(".cropper-canvas"),this.$dragger=r.find(".cropper-dragger"),this.$viewer=r.find(".cropper-viewer"),t.autoCrop?this.cropped=i:this.$dragger.addClass(h),t.dragCrop&&this.setDragMode("crop"),t.modal&&this.$canvas.addClass(y),!t.dashed&&this.$dragger.find(".cropper-dashed").addClass(h),!t.movable&&this.$dragger.find(".cropper-face").data(v,"move"),!t.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(h),this.$scope=t.multiple?this.$cropper:wt,this.addListeners(),this.initPreview(),this.built=i,this.update(),f.one(vt,t.built),f.trigger(vt)))},unbuild:function(){this.built&&(this.built=t,this.removeListeners(),this.$preview.empty(),this.$preview=f,this.$dragger=f,this.$canvas=f,this.$container=f,this.$cropper.remove(),this.$cropper=f)},update:function(n){this.initContainer();this.initCropper();this.initImage();this.initDragger();n?(this.setData(n,i),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing);this.resizing=setTimeout(n.proxy(this.update,this,this.getData()),200)},preview:function(){var t=this.image,i=this.dragger,u=t.width,f=t.height,e=i.left-t.left,o=i.top-t.top;this.$viewer.find("img").css({width:r(u),height:r(f),marginLeft:-r(e),marginTop:-r(o)});this.$preview.each(function(){var s=n(this),t=s.width()/i.width;s.find("img").css({width:r(u*t),height:r(f*t),marginLeft:-r(e*t),marginTop:-r(o*t)})})},addListeners:function(){var t=this.defaults;this.$element.on(b,t.dragstart).on(k,t.dragmove).on(d,t.dragend);this.$cropper.on(et,this._dragstart=n.proxy(this.dragstart,this)).on(lt,this._dblclick=n.proxy(this.dblclick,this));t.zoomable&&this.$cropper.on(ht,this._wheel=n.proxy(this.wheel,this));this.$scope.on(ot,this._dragmove=n.proxy(this.dragmove,this)).on(st,this._dragend=n.proxy(this.dragend,this));nt.on(ct,this._resize=n.proxy(this.resize,this))},removeListeners:function(){var n=this.defaults;this.$element.off(b,n.dragstart).off(k,n.dragmove).off(d,n.dragend);this.$cropper.off(et,this._dragstart).off(lt,this._dblclick);n.zoomable&&this.$cropper.off(ht,this._wheel);this.$scope.off(ot,this._dragmove).off(st,this._dragend);nt.off(ct,this._resize)},initPreview:function(){var t='<img src="'+this.url+'">';this.$preview=n(this.defaults.preview);this.$viewer.html(t);this.$preview.html(t).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var n=this.$container;this.container={width:s(n.width(),300),height:s(n.height(),150)}},initCropper:function(){var n,t=this.container,i=this.image;i.naturalWidth*t.height/i.naturalHeight-t.width>=0?(n={width:t.width,height:t.width/i.aspectRatio,left:0},n.top=(t.height-n.height)/2):(n={width:t.height*i.aspectRatio,height:t.height,top:0},n.left=(t.width-n.width)/2);this.$cropper.css({width:r(n.width),height:r(n.height),left:r(n.left),top:r(n.top)});this.cropper=n},initImage:function(){var i=this.image,r=this.cropper,u={_width:r.width,_height:r.height,width:r.width,height:r.height,left:0,top:0,ratio:r.width/i.naturalWidth};this.defaultImage=n.extend({},i,u);i._width!==r.width||i._height!==r.height?n.extend(i,u):(i=n.extend({},u,i),this.replaced&&(this.replaced=t,i.ratio=u.ratio));this.image=i;this.renderImage()},renderImage:function(n){var t=this.image;"zoom"===n&&(t.left-=(t.width-t.oldWidth)/2,t.top-=(t.height-t.oldHeight)/2);t.left=o(s(t.left,t._width-t.width),0);t.top=o(s(t.top,t._height-t.height),0);this.$clone.css({width:r(t.width),height:r(t.height),marginLeft:r(t.left),marginTop:r(t.top)});n&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var t,i=this.defaults,r=this.cropper,u=i.aspectRatio||this.image.aspectRatio,f=this.image.ratio;t=r.height*u-r.width>=0?{height:r.width/u,width:r.width,left:0,top:(r.height-r.width/u)/2,maxWidth:r.width,maxHeight:r.width/u}:{height:r.height,width:r.height*u,left:(r.width-r.height*u)/2,top:0,maxWidth:r.height*u,maxHeight:r.height};t.minWidth=0;t.minHeight=0;i.aspectRatio?(isFinite(i.maxWidth)?(t.maxWidth=o(t.maxWidth,i.maxWidth*f),t.maxHeight=t.maxWidth/u):isFinite(i.maxHeight)&&(t.maxHeight=o(t.maxHeight,i.maxHeight*f),t.maxWidth=t.maxHeight*u),i.minWidth>0?(t.minWidth=s(0,i.minWidth*f),t.minHeight=t.minWidth/u):i.minHeight>0&&(t.minHeight=s(0,i.minHeight*f),t.minWidth=t.minHeight*u)):(t.maxWidth=o(t.maxWidth,i.maxWidth*f),t.maxHeight=o(t.maxHeight,i.maxHeight*f),t.minWidth=s(0,i.minWidth*f),t.minHeight=s(0,i.minHeight*f));t.minWidth=o(t.maxWidth,t.minWidth);t.minHeight=o(t.maxHeight,t.minHeight);t.height*=i.autoCropArea;t.width*=i.autoCropArea;t.left=(r.width-t.width)/2;t.top=(r.height-t.height)/2;t.oldLeft=t.left;t.oldTop=t.top;this.defaultDragger=t;this.dragger=n.extend({},t)},renderDragger:function(){var n=this.dragger,t=this.cropper;n.width>n.maxWidth?(n.width=n.maxWidth,n.left=n.oldLeft):n.width<n.minWidth&&(n.width=n.minWidth,n.left=n.oldLeft);n.height>n.maxHeight?(n.height=n.maxHeight,n.top=n.oldTop):n.height<n.minHeight&&(n.height=n.minHeight,n.top=n.oldTop);n.left=o(s(n.left,0),t.width-n.width);n.top=o(s(n.top,0),t.height-n.height);n.oldLeft=n.left;n.oldTop=n.top;this.dragger=n;this.disabled||this.defaults.done(this.getData());this.$dragger.css({width:r(n.width),height:r(n.height),left:r(n.left),top:r(n.top)});this.preview()},reset:function(t){this.cropped&&(t&&(this.defaults.data={}),this.image=n.extend({},this.defaultImage),this.renderImage(),this.dragger=n.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=t,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(y),this.$dragger.addClass(h))},destroy:function(){var n=this.$element;this.ready&&(this.unbuild(),n.removeClass(h).removeData("cropper"),this.rotated&&n.attr("src",this.$original.attr("src")))},replace:function(r,u){var o,s=this,e=this.$element,f=this.element;r&&r!==this.url&&r!==e.attr("src")&&(u||(this.rotated=t,this.replaced=i),e.is("img")?(e.attr("src",r),this.load()):e.is("canvas")&&this.support.canvas&&(o=f.getContext("2d"),n('<img src="'+r+'">').one("load",function(){f.width=this.width;f.height=this.height;o.clearRect(0,0,f.width,f.height);o.drawImage(this,0,0);s.load()})))},setData:function(t,i){var o=this.cropper,r=this.dragger,u=this.image,e=this.defaults.aspectRatio;this.built&&typeof t!==it&&((t===f||n.isEmptyObject(t))&&(r=n.extend({},this.defaultDragger)),n.isPlainObject(t)&&!n.isEmptyObject(t)&&(i||(this.defaults.data=t),t=this.transformData(t),a(t.x)&&t.x<=o.width-u.left&&(r.left=t.x+u.left),a(t.y)&&t.y<=o.height-u.top&&(r.top=t.y+u.top),e?a(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth?(r.width=t.width,r.height=r.width/e):a(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height,r.width=r.height*e):(a(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth&&(r.width=t.width),a(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height))),this.dragger=r,this.renderDragger())},getData:function(n){var t=this.dragger,u=this.image,r={};return this.built&&(r={x:t.left-u.left,y:t.top-u.top,width:t.width,height:t.height},r=this.transformData(r,i,n)),r},transformData:function(t,i,u){var f=this.image.ratio,e={};return n.each(t,function(n,t){t=c(t);kt.test(n)&&!isNaN(t)&&(e[n]=i?u?r(t/f):t/f:t*f)}),e},setAspectRatio:function(n){var t="auto"===n;n=c(n);(t||!isNaN(n)&&n>0)&&(this.defaults.aspectRatio=t?tt:n,this.built&&(this.initDragger(),this.renderDragger()))},getImageData:function(){var t={};return this.ready&&n.each(this.image,function(n,i){dt.test(n)&&(t[n]=i)}),t},getDataURL:function(t,i,r){var f,e=n("<canvas>")[0],u=this.getData(),o="";return n.isPlainObject(t)||(r=i,i=t,t={}),t=n.extend({width:u.width,height:u.height},t),this.cropped&&this.support.canvas&&(e.width=t.width,e.height=t.height,f=e.getContext("2d"),"image/jpeg"===i&&(f.fillStyle="#fff",f.fillRect(0,0,t.width,t.height)),f.drawImage(this.$clone[0],u.x,u.y,u.width,u.height,0,0,t.width,t.height),o=e.toDataURL(i,r)),o},setDragMode:function(n){var r=this.$canvas,e=this.defaults,u=t,f=t;if(this.built&&!this.disabled){switch(n){case"crop":e.dragCrop&&(u=i,r.data(v,n));break;case"move":f=i;r.data(v,n);break;default:r.removeData(v)}r.toggleClass(ut,u).toggleClass(gt,f)}},enable:function(){this.built&&(this.disabled=t,this.$cropper.removeClass(ft))},disable:function(){this.built&&(this.disabled=i,this.$cropper.addClass(ft))},rotate:function(n){var t=this.image;n=c(n)||0;this.built&&0!==n&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=i,n=t.rotate=(t.rotate+n)%360,this.replace(this.getRotatedDataURL(n),!0))},getRotatedDataURL:function(t){var r=n("<canvas>")[0],i=r.getContext("2d"),a=t*Math.PI/180,s=e(t)%180,v=s>90?180-s:s,u=v*Math.PI/180,h=this.originalImage,f=h.naturalWidth,o=h.naturalHeight,c=e(f*pt(u)+o*yt(u)),l=e(f*yt(u)+o*pt(u));return r.width=c,r.height=l,i.save(),i.translate(c/2,l/2),i.rotate(a),i.drawImage(this.$original[0],-f/2,-o/2,f,o),i.restore(),r.toDataURL()},zoom:function(n){var i,u,r,t=this.image;n=c(n);this.built&&n&&!this.disabled&&this.defaults.zoomable&&(i=t.width*(1+n),u=t.height*(1+n),r=i/t._width,r>10||(1>r&&(i=t._width,u=t._height),this.setDragMode(1>=r?"crop":"move"),t.oldWidth=t.width,t.oldHeight=t.height,t.width=i,t.height=u,t.ratio=t.width/t.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(ut)?"move":"crop")},wheel:function(n){var t,i=n.originalEvent,r=117.25,u=5;this.disabled||(n.preventDefault(),i.deltaY?(t=i.deltaY,t=t%u==0?t/u:t%r==0?t/r:t/166.66665649414063):t=i.wheelDelta?-i.wheelDelta/120:i.detail?i.detail/3:0,this.zoom(t*.1))},dragstart:function(r){var f,o,s,e=r.originalEvent.touches,u=r;if(!this.disabled){if(e){if(s=e.length,s>1){if(!this.defaults.zoomable||2!==s)return;u=e[1];this.startX2=u.pageX;this.startY2=u.pageY;f="zoom"}u=e[0]}if(f=f||n(u.target).data(v),bt.test(f)){if(r.preventDefault(),o=n.Event(b),this.$element.trigger(o),o.isDefaultPrevented())return;this.directive=f;this.cropping=t;this.startX=u.pageX;this.startY=u.pageY;"crop"===f&&(this.cropping=i,this.$canvas.addClass(y))}}},dragmove:function(t){var u,f,r=t.originalEvent.touches,i=t;if(!this.disabled){if(r){if(f=r.length,f>1){if(!this.defaults.zoomable||2!==f)return;i=r[1];this.endX2=i.pageX;this.endY2=i.pageY}i=r[0]}if(this.directive){if(t.preventDefault(),u=n.Event(k),this.$element.trigger(u),u.isDefaultPrevented())return;this.endX=i.pageX;this.endY=i.pageY;this.dragging()}}},dragend:function(i){var r;if(!this.disabled&&this.directive){if(i.preventDefault(),r=n.Event(d),this.$element.trigger(r),r.isDefaultPrevented())return;this.cropping&&(this.cropping=t,this.$canvas.toggleClass(y,this.cropped&&this.defaults.modal));this.directive=""}},dragging:function(){var k,c=this.directive,b=this.image,d=this.cropper,p=d.width,v=d.height,a=this.dragger,r=a.width,u=a.height,s=a.left,f=a.top,w=s+r,y=f+u,l=i,nt=this.defaults,o=nt.aspectRatio,n={x:this.endX-this.startX,y:this.endY-this.startY};switch(o&&(n.X=n.y*o,n.Y=n.x/o),c){case"all":s+=n.x;f+=n.y;break;case"e":if(n.x>=0&&(w>=p||o&&(0>=f||y>=v))){l=t;break}r+=n.x;o&&(u=r/o,f-=n.Y/2);0>r&&(c="w",r=0);break;case"n":if(n.y<=0&&(0>=f||o&&(0>=s||w>=p))){l=t;break}u-=n.y;f+=n.y;o&&(r=u*o,s+=n.X/2);0>u&&(c="s",u=0);break;case"w":if(n.x<=0&&(0>=s||o&&(0>=f||y>=v))){l=t;break}r-=n.x;s+=n.x;o&&(u=r/o,f+=n.Y/2);0>r&&(c="e",r=0);break;case"s":if(n.y>=0&&(y>=v||o&&(0>=s||w>=p))){l=t;break}u+=n.y;o&&(r=u*o,s-=n.X/2);0>u&&(c="n",u=0);break;case"ne":if(o){if(n.y<=0&&(0>=f||w>=p)){l=t;break}u-=n.y;f+=n.y;r=u*o}else n.x>=0?p>w?r+=n.x:n.y<=0&&0>=f&&(l=t):r+=n.x,n.y<=0?f>0&&(u-=n.y,f+=n.y):(u-=n.y,f+=n.y);0>u&&(c="sw",u=0,r=0);break;case"nw":if(o){if(n.y<=0&&(0>=f||0>=s)){l=t;break}u-=n.y;f+=n.y;r=u*o;s+=n.X}else n.x<=0?s>0?(r-=n.x,s+=n.x):n.y<=0&&0>=f&&(l=t):(r-=n.x,s+=n.x),n.y<=0?f>0&&(u-=n.y,f+=n.y):(u-=n.y,f+=n.y);0>u&&(c="se",u=0,r=0);break;case"sw":if(o){if(n.x<=0&&(0>=s||y>=v)){l=t;break}r-=n.x;s+=n.x;u=r/o}else n.x<=0?s>0?(r-=n.x,s+=n.x):n.y>=0&&y>=v&&(l=t):(r-=n.x,s+=n.x),n.y>=0?v>y&&(u+=n.y):u+=n.y;0>r&&(c="ne",u=0,r=0);break;case"se":if(o){if(n.x>=0&&(w>=p||y>=v)){l=t;break}r+=n.x;u=r/o}else n.x>=0?p>w?r+=n.x:n.y>=0&&y>=v&&(l=t):r+=n.x,n.y>=0?v>y&&(u+=n.y):u+=n.y;0>r&&(c="nw",u=0,r=0);break;case"move":b.left+=n.x;b.top+=n.y;this.renderImage("move");l=t;break;case"zoom":nt.zoomable&&(this.zoom(function(n,t,i,r,u,f){return(g(u*u+f*f)-g(i*i+r*r))/g(n*n+t*t)}(b.width,b.height,e(this.startX-this.startX2),e(this.startY-this.startY2),e(this.endX-this.endX2),e(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":n.x&&n.y&&(k=this.$cropper.offset(),s=this.startX-k.left,f=this.startY-k.top,r=a.minWidth,u=a.minHeight,n.x>0?n.y>0?c="se":(c="ne",f-=u):n.y>0?(c="sw",s-=r):(c="nw",s-=r,f-=u),this.cropped||(this.cropped=i,this.$dragger.removeClass(h)))}l&&(a.width=r,a.height=u,a.left=s,a.top=f,this.directive=c,this.renderDragger());this.startX=this.endX;this.startY=this.endY}};u.TEMPLATE=function(n,t){return t=t.split(","),n.replace(/\d+/g,function(n){return t[n]})}('<0 6="5-container"><0 6="5-canvas"><\/0><0 6="5-dragger"><1 6="5-viewer"><\/1><1 6="5-8 8-h"><\/1><1 6="5-8 8-v"><\/1><1 6="5-face" 3-2="all"><\/1><1 6="5-7 7-e" 3-2="e"><\/1><1 6="5-7 7-n" 3-2="n"><\/1><1 6="5-7 7-w" 3-2="w"><\/1><1 6="5-7 7-s" 3-2="s"><\/1><1 6="5-4 4-e" 3-2="e"><\/1><1 6="5-4 4-n" 3-2="n"><\/1><1 6="5-4 4-w" 3-2="w"><\/1><1 6="5-4 4-s" 3-2="s"><\/1><1 6="5-4 4-ne" 3-2="ne"><\/1><1 6="5-4 4-nw" 3-2="nw"><\/1><1 6="5-4 4-sw" 3-2="sw"><\/1><1 6="5-4 4-se" 3-2="se"><\/1><\/0><\/0>',"div,span,directive,data,point,cropper,class,line,dashed");u.DEFAULTS={aspectRatio:"auto",autoCropArea:.8,data:{},done:n.noop,preview:"",multiple:t,autoCrop:i,dragCrop:i,dashed:i,modal:i,movable:i,resizable:i,zoomable:i,rotatable:i,checkImageOrigin:i,minWidth:0,minHeight:0,maxWidth:w,maxHeight:w,build:f,built:f,dragstart:f,dragmove:f,dragend:f};u.setDefaults=function(t){n.extend(u.DEFAULTS,t)};u.other=n.fn.cropper;n.fn.cropper=function(t){var i,r=[].slice.call(arguments,1);return this.each(function(){var e,o=n(this),f=o.data("cropper");f||o.data("cropper",f=new u(this,t));"string"==typeof t&&n.isFunction(e=f[t])&&(i=e.apply(f,r))}),typeof i!==it?i:this};n.fn.cropper.Constructor=u;n.fn.cropper.setDefaults=u.setDefaults;n.fn.cropper.noConflict=function(){return n.fn.cropper=u.other,this}})